<nav class="navbar navbar-expand-lg glass-morphism sticky-top py-2">
  <div class="container-fluid px-4">
    <a class="navbar-brand d-flex align-items-center" routerLink="/">
      <div
        class="bg-primary rounded-circle p-2 me-2 d-flex align-items-center justify-content-center"
        style="width: 40px; height: 40px"
      >
        <i class="bi bi-heart-pulse-fill text-white fs-5"></i>
      </div>
      <span class="fw-bold fs-4 gradient-text">MEDICUS</span>
    </a>

    <button
      class="navbar-toggler border-0 shadow-none"
      type="button"
      (click)="toggleSidebar.emit()"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarText">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-4">
        <li class="nav-item">
          <a class="nav-link px-3 fw-medium text-dark active" routerLink="/dashboard">{{
            langService.translate('common.dashboard')
          }}</a>
        </li>
      </ul>

      <div class="d-flex align-items-center gap-3">
        <!-- Settings Group -->
        <div
          class="d-flex align-items-center bg-light border rounded-pill px-2 py-1 gap-2 shadow-sm me-2"
        >
          <!-- Currency Toggle -->
          <div class="d-flex align-items-center gap-1">
            <button
              [class]="
                currencyService.currency() === 'USD'
                  ? 'btn btn-xs btn-primary rounded-circle p-1 active-lang'
                  : 'btn btn-xs text-muted p-1'
              "
              (click)="setCurrency('USD')"
              title="USD ($)"
              style="width: 28px; height: 28px; font-size: 10px; font-weight: bold"
            >
              $
            </button>
            <button
              [class]="
                currencyService.currency() === 'VES'
                  ? 'btn btn-xs btn-primary rounded-circle p-1 active-lang'
                  : 'btn btn-xs text-muted p-1'
              "
              (click)="setCurrency('VES')"
              title="VES (Bs.)"
              style="width: 28px; height: 28px; font-size: 10px; font-weight: bold"
            >
              Bs
            </button>
          </div>

          <div class="vr my-1 opacity-25"></div>

          <!-- Language Toggle -->
          <div class="d-flex align-items-center gap-1">
            <button
              [class]="
                langService.lang() === 'es'
                  ? 'btn btn-xs btn-primary rounded-circle p-1 active-lang'
                  : 'btn btn-xs text-muted p-1'
              "
              (click)="setLanguage('es')"
              style="width: 28px; height: 28px; font-size: 10px; font-weight: bold"
            >
              ES
            </button>
            <button
              [class]="
                langService.lang() === 'en'
                  ? 'btn btn-xs btn-primary rounded-circle p-1 active-lang'
                  : 'btn btn-xs text-muted p-1'
              "
              (click)="setLanguage('en')"
              style="width: 28px; height: 28px; font-size: 10px; font-weight: bold"
            >
              EN
            </button>
          </div>
        </div>

        <!-- User Dropdown Menu -->
        <div class="dropdown user-dropdown-container position-relative">
          <button
            class="btn border-0 d-flex align-items-center gap-2 p-1 px-3 glass-morphism rounded-pill shadow-sm"
            type="button"
            (click)="toggleUserMenu()"
            [class.active]="isUserMenuOpen"
          >
            <div
              class="rounded-circle d-flex align-items-center justify-content-center fw-bold text-white small"
              style="width: 32px; height: 32px; background-color: #0ea5e9"
            >
              {{ (authService.currentUser()?.firstName || 'U').charAt(0)
              }}{{ (authService.currentUser()?.lastName || '').charAt(0) }}
            </div>
            <span class="fw-semibold small d-none d-md-inline text-dark">{{
              authService.currentUser()?.firstName
            }}</span>
            <i
              class="bi bi-chevron-down small text-muted transition"
              [class.rotate-180]="isUserMenuOpen"
            ></i>
          </button>

          <ul
            class="dropdown-menu dropdown-menu-end border-0 shadow-lg p-2 rounded-4 mt-2"
            style="min-width: 220px; right: 0; top: 100%; z-index: 1050"
            [class.show]="isUserMenuOpen"
          >
            <!-- Header -->
            <li class="px-3 py-2 border-bottom mb-2">
              <p class="mb-0 fw-bold text-dark">
                {{ authService.currentUser()?.firstName }} {{ authService.currentUser()?.lastName }}
              </p>
              <p class="text-muted x-small mb-0 text-uppercase">
                {{ langService.translate('roles.' + authService.currentUser()?.role) }}
              </p>
            </li>
            <!-- Actions -->
            <li>
              <button
                class="dropdown-item rounded-3 py-2 d-flex align-items-center gap-2 small"
                (click)="openProfileModal(); isUserMenuOpen = false"
              >
                <i class="bi bi-person-gear text-primary"></i>
                {{ langService.translate('navbar.updateInfo') }}
              </button>
            </li>
            <li>
              <button
                class="dropdown-item rounded-3 py-2 d-flex align-items-center gap-2 small"
                (click)="openChangePasswordModal(); isUserMenuOpen = false"
              >
                <i class="bi bi-shield-lock text-primary"></i>
                {{ langService.translate('navbar.changePassword') }}
              </button>
            </li>
            <li><hr class="dropdown-divider my-2" /></li>
            <li>
              <button
                class="dropdown-item rounded-3 py-2 d-flex align-items-center gap-2 small text-danger"
                (click)="logout(); isUserMenuOpen = false"
              >
                <i class="bi bi-box-arrow-right"></i> {{ langService.translate('navbar.logout') }}
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</nav>
