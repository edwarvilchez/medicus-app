<div
  class="min-vh-100 d-flex flex-column"
  style="background: radial-gradient(circle at top right, #e0f2fe 0%, #f8fafc 50%)"
>
  <!-- Main Content Wrapper -->
  <div class="flex-grow-1 d-flex align-items-start justify-content-center py-5">
    <div class="row w-100 max-width-1200 px-4 my-0">
      <!-- Left Side: Hero content -->
      <div class="col-lg-5 d-none d-lg-flex flex-column justify-content-center pe-5">
        <div class="mb-4">
          <div class="bg-primary rounded-4 p-3 d-inline-block shadow-lg mb-4">
            <i class="bi bi-heart-pulse-fill text-white fs-1"></i>
          </div>
          <h1 class="h1 fw-bold mb-3">Únete a <br /><span class="gradient-text">Medicus</span></h1>
          <p class="fs-5 text-muted mb-4">
            Crea tu cuenta y accede a la <br />mejor plataforma de gestión clínica.
          </p>
        </div>

        <div class="row g-3">
          <div class="col-12 col-xl-10">
            <div
              class="glass-morphism p-3 rounded-4 shadow-sm cursor-pointer hover-scale transition-all"
              routerLink="/agendar-cita"
            >
              <div class="d-flex align-items-center gap-3">
                <i class="bi bi-calendar-check text-primary fs-3"></i>
                <div>
                  <h6 class="fw-bold mb-0">Agenda Fácil</h6>
                  <p class="small text-muted mb-0">Reserva tus citas médicas en segundos.</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-xl-10">
            <div
              class="glass-morphism p-3 rounded-4 shadow-sm cursor-pointer hover-scale transition-all"
              (click)="viewHistory()"
            >
              <div class="d-flex align-items-center gap-3">
                <i class="bi bi-file-medical text-success fs-3"></i>
                <div>
                  <h6 class="fw-bold mb-0">Historial Digital</h6>
                  <p class="small text-muted mb-0">
                    Accede a tu historial médico desde cualquier lugar.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side: Register Form -->
      <div class="col-lg-7">
        <div class="card-premium border-0 p-3 shadow-lg animate-fade-in">
          <div class="text-center mb-3">
            <!-- Branding -->
            <div class="d-flex align-items-center justify-content-center gap-2 mb-1">
              <div class="bg-primary rounded-3 p-1.5 d-inline-flex">
                <i class="bi bi-heart-pulse-fill text-white" style="font-size: 1rem"></i>
              </div>
              <h2 class="fw-bold mb-0 text-primary" style="font-size: 1.3rem">MEDICUS</h2>
            </div>
            
            <!-- Step indicator -->
            <div class="d-flex align-items-center justify-content-center gap-2 mb-2">
              <span 
                class="badge rounded-pill px-3 py-1"
                [class.bg-primary]="step() === 1"
                [class.bg-secondary]="step() !== 1"
              >
                1
              </span>
              <div class="progress" style="width: 60px; height: 4px;">
                <div 
                  class="progress-bar" 
                  [style.width.%]="step() === 1 ? 0 : 100"
                  style="background-color: #0ea5e9; transition: width 0.3s ease;"
                ></div>
              </div>
              <span 
                class="badge rounded-pill px-3 py-1"
                [class.bg-primary]="step() === 2"
                [class.bg-secondary]="step() !== 2"
              >
                2
              </span>
            </div>
            
            <p class="fw-bold mb-0">
              {{ step() === 1 ? '¿Quién eres?' : langService.translate('register.title') }}
            </p>
            <p class="text-muted x-small mb-0">
              {{ step() === 1 ? 'Selecciona el tipo de cuenta que necesitas' : langService.translate('register.subtitle') }}
            </p>
          </div>

          <!-- STEP 1: Account Type Selection -->
          <div *ngIf="step() === 1" class="animate-fade-in">
            <div class="row g-3 mb-4">
              <div class="col-6" *ngFor="let option of orgOptions">
                <div
                  class="account-type-card h-100 p-3 rounded-4 border-2 cursor-pointer text-center transition-all"
                  [class.border-primary]="accountType() === option.type"
                  [class.bg-primary-subtle]="accountType() === option.type"
                  [class.border-light]="accountType() !== option.type"
                  [class.shadow-sm]="accountType() === option.type"
                  (click)="selectAccountType(option.type)"
                >
                  <div 
                    class="icon-wrapper mb-2 mx-auto d-flex align-items-center justify-content-center rounded-3"
                    [class.bg-primary]="option.color === 'primary'"
                    [class.bg-success]="option.color === 'success'"
                    [class.bg-info]="option.color === 'info'"
                    [class.bg-warning]="option.color === 'warning'"
                    style="width: 56px; height: 56px;"
                  >
                    <i [class]="'bi ' + option.icon + ' text-white fs-2'"></i>
                  </div>
                  <h6 class="fw-bold mb-1">{{ langService.translate(option.labelKey) }}</h6>
                  <p class="x-small text-muted mb-0">{{ langService.translate(option.descKey) }}</p>
                </div>
              </div>
            </div>
            
            <div class="text-center">
              <p class="text-muted small mb-0">
                ¿Ya tienes una cuenta?
                <a routerLink="/login" class="text-primary fw-bold text-decoration-none">
                  Inicia Sesión
                </a>
              </p>
            </div>
          </div>

          <!-- STEP 2: Registration Form -->
          <form *ngIf="step() === 2" [formGroup]="registerForm" (ngSubmit)="onSubmit()">
            <!-- Back button -->
            <div class="mb-3">
              <button 
                type="button" 
                class="btn btn-link text-muted text-decoration-none p-0"
                (click)="goBack()"
              >
                <i class="bi bi-arrow-left me-1"></i>
                Volver a selección de cuenta
              </button>
            </div>

            <!-- Selected account type badge -->
            <div class="mb-3">
              <span class="badge rounded-pill px-3 py-2" [class]="'bg-' + getSelectedOption()?.color">
                <i [class]="'bi ' + getSelectedOption()?.icon + ' me-1'"></i>
                {{ langService.translate(getSelectedOption()?.labelKey || '') }}
              </span>
            </div>

            <!-- Scrollable Fields Container -->
            <div
              style="max-height: 50vh; overflow-y: auto; overflow-x: hidden; padding: 0.5rem 0.2rem"
              class="custom-scrollbar px-1 mb-2"
            >
              <!-- Username & Email -->
              <div class="row g-2 mb-2">
                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">{{
                    langService.translate('common.username')
                  }}</label>
                  <input
                    type="text"
                    class="form-control glass-morphism border rounded-3 py-1.5"
                    formControlName="username"
                    placeholder="usuario123"
                  />
                  <small
                    class="text-danger"
                    *ngIf="
                      registerForm.get('username')?.touched && registerForm.get('username')?.invalid
                    "
                  >
                    {{ getErrorMessage('username') }}
                  </small>
                </div>

                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">{{
                    langService.translate('auth.email')
                  }}</label>
                  <input
                    type="email"
                    class="form-control glass-morphism border rounded-3 py-1.5"
                    formControlName="email"
                    placeholder="correo@ejemplo.com"
                  />
                  <small
                    class="text-danger"
                    *ngIf="registerForm.get('email')?.touched && registerForm.get('email')?.invalid"
                  >
                    {{ getErrorMessage('email') }}
                  </small>
                </div>
              </div>

              <!-- Password & Confirm -->
              <div class="row g-2 mb-2">
                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">{{
                    langService.translate('auth.password')
                  }}</label>
                  <div class="position-relative">
                    <input
                      [type]="showPassword() ? 'text' : 'password'"
                      class="form-control glass-morphism border rounded-3 py-1.5 pe-5"
                      formControlName="password"
                      placeholder="••••••••"
                    />
                    <button
                      type="button"
                      class="btn btn-link position-absolute end-0 top-50 translate-middle-y text-muted border-0 shadow-none px-3"
                      (click)="showPassword.set(!showPassword())"
                    >
                      <i
                        class="bi"
                        [ngClass]="showPassword() ? 'bi-eye-slash-fill' : 'bi-eye-fill'"
                      ></i>
                    </button>
                  </div>
                  <small
                    class="text-danger"
                    *ngIf="
                      registerForm.get('password')?.touched && registerForm.get('password')?.invalid
                    "
                  >
                    {{ getErrorMessage('password') }}
                  </small>
                </div>

                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">{{
                    langService.translate('common.confirm')
                  }}</label>
                  <div class="position-relative">
                    <input
                      [type]="showConfirmPassword() ? 'text' : 'password'"
                      class="form-control glass-morphism border rounded-3 py-1.5 pe-5"
                      formControlName="confirmPassword"
                      placeholder="••••••••"
                    />
                    <button
                      type="button"
                      class="btn btn-link position-absolute end-0 top-50 translate-middle-y text-muted border-0 shadow-none px-3"
                      (click)="showConfirmPassword.set(!showConfirmPassword())"
                    >
                      <i
                        class="bi"
                        [ngClass]="showConfirmPassword() ? 'bi-eye-slash-fill' : 'bi-eye-fill'"
                      ></i>
                    </button>
                  </div>
                  <small
                    class="text-danger"
                    *ngIf="
                      registerForm.get('confirmPassword')?.touched &&
                      registerForm.get('confirmPassword')?.invalid
                    "
                  >
                    {{ getErrorMessage('confirmPassword') }}
                  </small>
                </div>
              </div>

              <!-- First & Last Name -->
              <div class="row g-2 mb-2">
                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">{{
                    langService.translate('nurses.fields.firstName')
                  }}</label>
                  <input
                    type="text"
                    class="form-control glass-morphism border rounded-3 py-1.5"
                    formControlName="firstName"
                    placeholder="Juan"
                  />
                  <small
                    class="text-danger"
                    *ngIf="
                      registerForm.get('firstName')?.touched &&
                      registerForm.get('firstName')?.invalid
                    "
                  >
                    {{ getErrorMessage('firstName') }}
                  </small>
                </div>

                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">{{
                    langService.translate('nurses.fields.lastName')
                  }}</label>
                  <input
                    type="text"
                    class="form-control glass-morphism border rounded-3 py-1.5"
                    formControlName="lastName"
                    placeholder="Pérez"
                  />
                  <small
                    class="text-danger"
                    *ngIf="
                      registerForm.get('lastName')?.touched && registerForm.get('lastName')?.invalid
                    "
                  >
                    {{ getErrorMessage('lastName') }}
                  </small>
                </div>
              </div>

              <!-- Patient Specific Fields -->
              <div *ngIf="isPatient()">
                <div class="row g-2 mb-2">
                  <div class="col-md-6">
                    <label class="form-label small fw-bold mb-1">{{
                      langService.translate('medical_history.id')
                    }}</label>
                    <input
                      type="text"
                      class="form-control glass-morphism border rounded-3 py-1.5"
                      formControlName="documentId"
                      placeholder="V-12345678"
                    />
                    <small
                      class="text-danger"
                      *ngIf="
                        registerForm.get('documentId')?.touched &&
                        registerForm.get('documentId')?.invalid
                      "
                    >
                      {{ getErrorMessage('documentId') }}
                    </small>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label small fw-bold mb-1">
                      <i class="bi bi-whatsapp text-success me-1"></i
                      >{{ langService.translate('medical_history.phone') }}
                    </label>
                    <input
                      type="tel"
                      class="form-control glass-morphism border rounded-3 py-1.5"
                      formControlName="phone"
                      placeholder="+58 424-1234567"
                    />
                    <small
                      class="text-danger"
                      *ngIf="
                        registerForm.get('phone')?.touched && registerForm.get('phone')?.invalid
                      "
                    >
                      {{ getErrorMessage('phone') }}
                    </small>
                  </div>
                </div>

                <div class="row g-2 mb-2">
                  <div class="col-md-6">
                    <label class="form-label small fw-bold mb-1">{{
                      langService.translate('common.birthDate')
                    }}</label>
                    <input
                      type="date"
                      class="form-control glass-morphism border rounded-3 py-1.5"
                      formControlName="birthDate"
                    />
                  </div>

                  <div class="col-md-6">
                    <label class="form-label small fw-bold mb-1">{{
                      langService.translate('medical_history.gender')
                    }}</label>
                    <select
                      class="form-select glass-morphism border rounded-3 py-1.5"
                      formControlName="gender"
                    >
                      <option value="">{{ langService.translate('payments.select') }}</option>
                      <option value="Male">{{ langService.translate('common.male') }}</option>
                      <option value="Female">{{ langService.translate('common.female') }}</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Provider Specific Fields -->
              <div *ngIf="isProvider()">
                <div
                  class="mb-2"
                  *ngIf="needsBusinessName()"
                >
                  <label class="form-label small fw-bold mb-1">{{
                    langService.translate('landing.businessName')
                  }}</label>
                  <input
                    type="text"
                    class="form-control glass-morphism border rounded-3 py-2"
                    formControlName="businessName"
                    [placeholder]="langService.translate('landing.businessNamePlaceholder')"
                  />
                  <small
                    class="text-danger"
                    *ngIf="
                      registerForm.get('businessName')?.touched &&
                      registerForm.get('businessName')?.invalid
                    "
                  >
                    {{ getErrorMessage('businessName') }}
                  </small>
                </div>

                <div class="row g-2 mb-2">
                  <div class="col-md-6">
                    <label class="form-label small fw-bold mb-1">{{
                      langService.translate('register.license')
                    }}</label>
                    <input
                      type="text"
                      class="form-control glass-morphism border rounded-3 py-1.5"
                      formControlName="licenseNumber"
                      placeholder="Nº Colegiatura"
                    />
                    <small
                      class="text-danger"
                      *ngIf="
                        registerForm.get('licenseNumber')?.touched &&
                        registerForm.get('licenseNumber')?.invalid
                      "
                    >
                      {{ getErrorMessage('licenseNumber') }}
                    </small>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label small fw-bold mb-1">{{
                      langService.translate('medical_history.phone')
                    }}</label>
                    <input
                      type="tel"
                      class="form-control glass-morphism border rounded-3 py-1.5"
                      formControlName="phone"
                      placeholder="Teléfono contacto"
                    />
                    <small
                      class="text-danger"
                      *ngIf="
                        registerForm.get('phone')?.touched && registerForm.get('phone')?.invalid
                      "
                    >
                      {{ getErrorMessage('phone') }}
                    </small>
                  </div>
                </div>
              </div>

              <!-- Address (Common to all if provider, or patient optional) -->
              <div class="mb-2">
                <label class="form-label small fw-bold mb-1">{{
                  langService.translate('register.address')
                }}</label>
                <input
                  type="text"
                  class="form-control glass-morphism border rounded-3 py-2"
                  formControlName="address"
                  placeholder="Calle, ciudad, estado..."
                />
              </div>

              <!-- Patient-only: Blood Type & Allergies -->
              <div class="row g-2 mb-3" *ngIf="isPatient()">
                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">Tipo Sangre (Opcional)</label>
                  <select
                    class="form-select glass-morphism border rounded-3 py-1.5"
                    formControlName="bloodType"
                  >
                    <option value="">Seleccionar...</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="form-label small fw-bold mb-1">Alergias (Opcional)</label>
                  <input
                    type="text"
                    class="form-control glass-morphism border rounded-3 py-1.5"
                    formControlName="allergies"
                    placeholder="Penicilina, Polen..."
                  />
                </div>
              </div>
            </div>

            <!-- Compliance & Transparency Checkbox -->
            <div class="mb-3 px-1">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="acceptTerms"
                  formControlName="acceptTerms"
                />
                <label class="form-check-label x-small text-muted lh-sm" for="acceptTerms">
                  Acepto los términos y la política de privacidad. Mis datos serán tratados bajo los
                  estándares
                  <span class="fw-bold text-primary">ISO 27001</span> (Seguridad),
                  <span class="fw-bold text-success">ISO 9001</span> (Calidad) y el cumplimiento de
                  la <span class="fw-bold text-info">GDPR</span> (Protección de Datos
                  Internacional).
                </label>
              </div>
              <small
                class="text-danger x-small d-block mt-1"
                *ngIf="
                  registerForm.get('acceptTerms')?.touched &&
                  registerForm.get('acceptTerms')?.invalid
                "
              >
                Debes aceptar los términos para continuar.
              </small>
            </div>

            <!-- Submit Button -->
            <div class="d-grid gap-2 mt-2">
              <button type="submit" class="btn btn-primary-premium py-2" [disabled]="loading">
                <span *ngIf="!loading">
                  <i class="bi bi-person-plus-fill me-2"></i>Crear Cuenta
                </span>
                <span *ngIf="loading">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Registrando...
                </span>
              </button>

              <div class="text-center">
                <p class="text-muted mb-0 small">
                  ¿Ya tienes una cuenta?
                  <a routerLink="/login" class="text-primary fw-bold text-decoration-none">
                    Inicia Sesión
                  </a>
                </p>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer removed -->
</div>

<style>
  .account-type-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid transparent;
    background: rgba(255, 255, 255, 0.7);
  }
  
  .account-type-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px -8px rgba(14, 165, 233, 0.25);
    border-color: #0ea5e9;
  }
  
  .account-type-card.border-primary {
    border-color: #0ea5e9;
    background: rgba(14, 165, 233, 0.08);
  }
  
  .icon-wrapper {
    transition: transform 0.3s ease;
  }
  
  .account-type-card:hover .icon-wrapper {
    transform: scale(1.1);
  }
  
  .progress-bar {
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>
