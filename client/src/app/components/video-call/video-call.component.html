<div class="video-call-container">
  <!-- Video Remoto (Principal) -->
  <div class="remote-video-wrapper">
    <video #remoteVideo autoplay playsinline class="remote-video"></video>

    <!-- Etiqueta Nombre Remoto -->
    @if (videoService.isConnected()) {
      <div class="participant-label remote-label">
        <i class="bi bi-person-video"></i> {{ participantName() }}
      </div>
    }

    <!-- Overlay de espera -->
    @if (!videoService.isConnected()) {
      <div class="waiting-overlay">
        <div class="spinner-border text-light mb-3" role="status">
          <span class="visually-hidden">Conectando...</span>
        </div>
        <h4 class="text-white">Esperando al otro participante...</h4>
        <p class="text-white-50">{{ participantName() }}</p>
      </div>
    }

    <!-- Mensaje de error -->
    @if (videoService.connectionError()) {
      <div class="error-overlay">
        <i class="bi bi-exclamation-triangle-fill text-warning" style="font-size: 3rem"></i>
        <p class="mt-3 text-white">{{ videoService.connectionError() }}</p>
      </div>
    }
  </div>

  <!-- Video Local (Picture-in-Picture) -->
  <div class="local-video-wrapper">
    <video #localVideo autoplay muted playsinline class="local-video"></video>
    @if (videoService.isVideoOff()) {
      <div class="video-off-overlay">
        <i class="bi bi-camera-video-off"></i>
        <span class="small">Cámara apagada</span>
      </div>
    }
    <div class="participant-label local-label">
      <i class="bi bi-person-circle"></i> {{ localParticipantName() }}
    </div>
  </div>

  <!-- Información de la llamada -->
  <div class="call-info">
    <div class="info-card">
      <div class="d-flex align-items-center gap-2">
        @if (videoService.isConnected()) {
          <span class="badge bg-success"> <i class="bi bi-circle-fill blink"></i> Conectado </span>
        } @else {
          <span class="badge bg-warning"> <i class="bi bi-circle-fill"></i> Esperando... </span>
        }

        <span class="text-white"> <i class="bi bi-clock"></i> {{ callDuration() }} </span>
      </div>

      <div class="participant-info mt-2">
        <small class="text-white-50">{{ isDoctor() ? 'Paciente' : 'Doctor' }}:</small>
        <div class="text-white fw-bold">{{ participantName() }}</div>
      </div>
    </div>
  </div>

  <!-- Controles -->
  <div class="controls">
    <!-- Silenciar/Activar Micrófono -->
    <button
      class="btn btn-control"
      [class.active]="!videoService.isMuted()"
      [class.muted]="videoService.isMuted()"
      (click)="toggleMute()"
      title="{{ videoService.isMuted() ? 'Activar micrófono' : 'Silenciar micrófono' }}"
    >
      <i
        class="bi"
        [class.bi-mic-fill]="!videoService.isMuted()"
        [class.bi-mic-mute-fill]="videoService.isMuted()"
      ></i>
    </button>

    <!-- Apagar/Encender Cámara -->
    <button
      class="btn btn-control"
      [class.active]="!videoService.isVideoOff()"
      [class.video-off]="videoService.isVideoOff()"
      (click)="toggleVideo()"
      title="{{ videoService.isVideoOff() ? 'Encender cámara' : 'Apagar cámara' }}"
    >
      <i
        class="bi"
        [class.bi-camera-video-fill]="!videoService.isVideoOff()"
        [class.bi-camera-video-off-fill]="videoService.isVideoOff()"
      ></i>
    </button>

    <!-- Finalizar Llamada -->
    <button class="btn btn-danger btn-end-call" (click)="endCall()" title="Finalizar videoconsulta">
      <i class="bi bi-telephone-x-fill"></i>
      <span class="d-none d-md-inline ms-2">Finalizar</span>
    </button>
  </div>

  <!-- Indicador de rol -->
  <div class="role-indicator">
    @if (isDoctor()) {
      <span class="badge bg-primary"> <i class="bi bi-person-badge"></i> Doctor </span>
    } @else {
      <span class="badge bg-info"> <i class="bi bi-person"></i> Paciente </span>
    }
  </div>
</div>
