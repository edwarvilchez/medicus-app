<div class="animate-fade-in">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">{{ langService.translate('patients_list.title') }}</h2>
      <p class="text-muted">{{ langService.translate('patients_list.subtitle') }}</p>
    </div>
    <button class="btn btn-primary-premium" (click)="createNewPatient()">
      <i class="bi bi-person-plus-fill me-2"></i> {{ langService.translate('patients_list.new') }}
    </button>
  </div>

  <div class="card-premium border-0 p-4 mb-4">
    <div class="row g-3">
      <div class="col-md-8">
        <div class="input-group glass-morphism rounded-3 border">
          <span class="input-group-text bg-transparent border-0"
            ><i class="bi bi-search text-muted"></i
          ></span>
          <input
            type="text"
            class="form-control bg-transparent border-0 py-2 shadow-none"
            [placeholder]="langService.translate('patients_list.searchPlaceholder')"
            [(ngModel)]="searchTerm"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
      <div class="col-md-2">
        <select
          class="form-select glass-morphism border rounded-3 py-2"
          [(ngModel)]="genderFilter"
          [ngModelOptions]="{ standalone: true }"
        >
          <option value="all">{{ langService.translate('patients_list.allGenders') }}</option>
          <option value="Male">Masculino</option>
          <option value="Female">Femenino</option>
          <option value="Other">Otro</option>
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-primary-premium w-100 py-2" (click)="toggleAdvancedFilters()">
          <i class="bi bi-funnel me-1"></i> {{ langService.translate('common.dashboard') }}
        </button>
      </div>
    </div>

    <!-- Advanced Filters Panel -->
    <div class="mt-3 p-3 bg-light rounded-3" *ngIf="showAdvancedFilters()">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="mb-0 fw-bold">{{ langService.translate('common.dashboard') }}</h6>
        <button class="btn btn-sm btn-outline-secondary" (click)="clearFilters()">
          <i class="bi bi-x-circle me-1"></i> {{ langService.translate('common.cancel') }}
        </button>
      </div>
      <div class="row g-2">
        <div class="col-md-12">
          <p class="text-muted small mb-0">
            <i class="bi bi-info-circle me-1"></i>
            Mostrando {{ filteredPatients().length }} de {{ patients().length }} pacientes
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="card-premium border-0 overflow-hidden">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
          <tr>
            <th class="ps-4 py-3">{{ langService.translate('patients_list.table.patient') }}</th>
            <th>{{ langService.translate('patients_list.table.document') }}</th>
            <th>{{ langService.translate('patients_list.table.gender') }}</th>
            <th>{{ langService.translate('patients_list.table.phone') }}</th>
            <th>{{ langService.translate('common.status') }}</th>
            <th class="text-end pe-4">{{ langService.translate('common.actions') }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of filteredPatients()">
            <td class="ps-4">
              <div class="d-flex align-items-center gap-3">
                <img
                  [src]="
                    'https://ui-avatars.com/api/?name=' + p.User.firstName + '+' + p.User.lastName
                  "
                  class="rounded-circle"
                  width="38"
                />
                <div>
                  <h6 class="mb-0 fw-bold">{{ p.User.firstName }} {{ p.User.lastName }}</h6>
                  <span class="small text-muted">{{ p.User.email }}</span>
                </div>
              </div>
            </td>
            <td>{{ p.documentId }}</td>
            <td>{{ p.gender }}</td>
            <td>{{ p.phone }}</td>
            <td>
              <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3">{{
                langService.translate('dashboard.active')
              }}</span>
            </td>
            <td class="text-end pe-4">
              <div class="action-buttons">
                <button
                  class="btn btn-sm btn-light border-0 me-1"
                  [title]="langService.translate('common.actions')"
                  (click)="viewHistory(p.id)"
                >
                  <i class="bi bi-eye"></i>
                </button>
                <button
                  class="btn btn-sm btn-light border-0 me-1"
                  [title]="langService.translate('common.actions')"
                >
                  <i class="bi bi-pencil"></i>
                </button>
                <button
                  class="btn btn-sm btn-light border-0 text-danger"
                  [title]="langService.translate('common.actions')"
                  (click)="deletePatient(p.id)"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="filteredPatients().length === 0">
            <td colspan="6" class="text-center py-4 text-muted">
              {{ langService.translate('common.noResults') }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
